---
import { Image } from 'astro:assets';
import { getProjects } from '../lib/projects.js';
import WebGLScene from './webgl/WebGLScene.astro';

const projects = await getProjects();

const navItems = [
	{
		name: "Works",
		class: "",
		distanceNumber: 1
	},
	{
		name: "About",
		class: "",
		distanceNumber: 2
	},
	{
		name: "Private Projects",
		class: "opacity-40 pointer-events-none mt-6"
	},
	{
		name: "Photos",
		class: "",
		distanceNumber: 3
	},
	{
		name: "Playground",
		class: "",
		distanceNumber: 4
	}
];

const playgrounds = [
	"#001_projectName",
	"#002_projectName",
	"#003_projectName",
	"#004_projectName",
	"#005_projectName",
	"#006_projectName",
	"#007_projectName"
];
---

<main class="relative h-[1000vh] bg-base">
    <WebGLScene movies={projects.slice(0,7).map(p => p.moviePc)} />
		
	<div class="fixed top-[15vh] left-0 grid grid-cols-4 gap-x-[8px] gap-y-10 w-full px-s-16-60 text-accent z-10 lg:grid-cols-6 lg:gap-x-4 lg:gap-y-0 lg:left-0 lg:top-more-40 lg:px-s-20-60">
		<div class="relative col-start-3 justify-self-start lg:hidden">
			<div class="active-nav-line absolute top-0 left-full w-[2px] h-full"></div>
			<div class=" leading-snug bg-accent/20" data-name="name-area"></div>
		</div>

		<div class="hidden lg:block col-start-5">
			<div class="grid grid-cols-1">
				{navItems.map((item) => (
					<a x-on:click={`anchorLink(${item.distanceNumber}, true)`} href={`#${item.name.toLowerCase().replace(/\s+/g, '-')}`} class={`relative ${item.class}`}>
						<div class="absolute top-0 right-[calc(100%+3px)] w-[2px] h-4/5 bg-black01 hidden"></div>
						{item.name}
					</a>
				))}
			</div>
		</div>

		<div class="relative col-span-4 lg:col-span-6">
			<!-- works -->
			<div data-name="works-info" class="absolute top-0 left-0 w-full h-auto grid grid-cols-4 gap-x-[8px] gap-y-8 z-10 lg:grid-cols-6 lg:gap-x-4">
				<div class="col-span-2 col-start-3 grid grid-cols-1 gap-y-[0.5em] lg:col-start-5 lg:mt-more-60">
					{projects.map(project => (						
						<button 
							class="js-project-modal-btn text-left leading-tight cursor-pointer" 
							data-project-slug={project.slug}
							data-name="kinetic-txt"
							data-text={project.title}
						>
							{project.title}
						</button>
					))}
				</div>
			</div>

			<!-- about -->
			<div data-name="about-area" class="absolute top-0 left-0 w-full h-auto hidden grid-cols-4 gap-x-[8px] gap-y-10 lg:top-more-60 lg:grid-cols-6 lg:gap-x-4 lg:gap-y-10">
				<p class="grid grid-cols-1 col-span-2 col-start-3 text-more-32 font-semibold -tracking-widest leading-none whitespace-nowrap lg:text-[5.3vw] lg:tracking-tighter lg:col-start-5 lg:translate-x-[-0.065em]">
					<span class="-translate-x-[3em]" data-name="kinetic-txt">create</span>
					<span class="-translate-x-[1.5em]" data-name="kinetic-txt">your</span>
					<span data-name="kinetic-txt">uniqueness</span>
				</p>
				<div class="grid grid-cols-1 gap-y-[1.2em] col-span-2 col-start-3 lg:col-span-2 lg:col-start-5 lg:pr-[25%]">
					<p data-name="kinetic-txt" class="">born in 1988 and worked as a designer in my twenties and entered the web industry as an engineer in my thirties. I like to think about design and direction.</p>
					<p data-name="kinetic-txt" class="text-more-10 opacity-40">1988年生まれ。20代はデザイナー、30代からweb業界に入りエンジニアとして働いています。デザインや演出を考えるのが好きです。</p>
				</div>
			</div>

			<!-- photos -->
			<div data-name="photos-area" class="absolute top-0 left-0 w-full h-auto hidden grid-cols-4 gap-x-[8px] gap-y-8 lg:grid-cols-6">
				<p data-name="kinetic-txt" class="col-span-2 col-start-3 lg:col-start-5 lg:col-span-1 lg:mt-24">These are the photos I usually take in private. Take a look if you like! My favorite camera is FUJIFILM X-E4.</p>
			</div>

			<!-- playground -->
			<div data-name="playground-area" class="absolute top-0 left-0 w-full h-auto hidden grid-cols-4 gap-x-[8px] gap-y-8 lg:grid-cols-6">

				<p data-name="kinetic-txt" class="col-span-2 col-start-3 lg:col-start-5 lg:col-span-1 lg:mt-24">This is a playground for learning and outputting 3D staging on a regular basis.</p>
				<div class=" col-span-2 col-start-3 grid grid-cols-1 gap-y-[0.4em] lg:col-start-5 lg:col-span-1">
					{playgrounds.map((playground, index) => (
						<a 
							href={`/${playground.toLowerCase().replace(/\s+/g, '-')}.html`}
							class=""
							data-name="kinetic-txt"
						>
							{playground}
						</a>
					))}
				</div>
			</div>			
		</div>
	</div>

	<!-- モーダルコンテナ -->
	<div data-name="modal-container" class="hidden fixed top-0 left-0 w-full h-full z-[9999] lg:w-[calc((100vw-var(--s-20-60)*2-5rem)/6*4+3rem+var(--s-20-60))]">
		<div data-name="btn-close" class="absolute left-0 top-0 h-more-120 w-more-24 text-more-12 bg-accent z-30 flex flex-col gap-y-3 items-center justify-center lg:hidden">
			<span class="relative w-[9px] h-[9px] block pointer-events-none">
				<span class="absolute top-[4px] left-0 w-full h-[1px] bg-base rotate-45"></span>
				<span class="absolute top-[4px] left-0 w-full h-[1px] bg-base -rotate-45"></span>
			</span>
			<span class="text-more-12 text-base [writing-mode:vertical-lr] pointer-events-none">close</span>
		</div>

		{projects.map(project => (
		<article data-name={project.slug} class="hidden absolute top-0 left-0 w-auto h-full ml-more-16 pl-more-12 bg-accent text-base overflow-y-scroll lg:col-span-5 lg:col-start-2 lg:pt-more-40 lg:px-4 lg:ml-0">
			<div data-name="btn-close" class="hidden sticky top-0 right-0 cursor-pointer w-fit ml-auto bg-accent py-0.5 text-more-12 justify-end gap-x-3 items-center lg:flex">
				<span class="relative w-[9px] h-[9px] block">
					<span class="absolute top-[4px] left-0 w-full h-[1px] bg-base rotate-45"></span>
					<span class="absolute top-[4px] left-0 w-full h-[1px] bg-base -rotate-45"></span>
				</span>
				<span class="text-more-12 text-base">close</span>
			</div>

			<div class="lg:mt-more-20">
				<header>
					{ project.moviePc && (
						<div class="col-span-2 bg-gray01">
						<video src={project.moviePc} autoplay loop muted playsinline class="w-full h-auto"></video>
						</div>
					)}

					<div class="grid grid-cols-1 gap-y-more-40 mt-more-20 lg:grid-cols-2 lg:items-start lg:mt-[3em]">
						<div class="grid grid-cols-1 gap-y-[1.4em] lg:gap-y-[3em]">
							<h3 class="">{project.title}</h3>
							<ul class="grid grid-cols-1 gap-y-[0.4em]">
								<li class="flex items-center gap-x-3">
									<p class="text-gray01">Role</p>
									<p>{project.role}</p>
								</li>
								<li class="flex items-center gap-x-3">
									<p class="text-gray01">Date</p>
									<p>{project.date}</p>
								</li>
								<li>
									<a data-name="link-view-project" class="underline" href={project.url} target="_blank" rel="noopener noreferrer">View Project</a>
								</li>
							</ul>
						</div>
						<div class="grid grid-cols-1 gap-y-[1em]">
							<p>{project.description}</p>
							<p>{project.descriptionEn}</p>
						</div>
					</div>
				</header>

				<div class="grid grid-cols-2 gap-x-[8px] gap-y-[1em] mt-16 lg:mt-[6em] lg:gap-y-[2em] lg:gap-x-[1em]">
					{ project.hero && (
						<div class="col-span-2 bg-gray01 aspect-video overflow-hidden">
							<Image src={project.hero || "/placeholder.svg"} alt={project.title} width={1600} height={900} class="w-full h-full object-cover"></Image>
						</div>
					)}
					{ project.movieMotion01 && (
						<div class="col-span-1 bg-gray01 aspect-square overflow-hidden">
							<video src={project.movieMotion01} autoplay loop muted playsinline class="w-full h-full object-cover"></video>
						</div>
					)}
					{ project.movieMotion02 && (
						<div class="col-span-1 bg-gray01 aspect-square overflow-hidden">
							<video src={project.movieMotion02} autoplay loop muted playsinline class="w-full h-full object-cover"></video>
						</div>
					)}
					{ project.imagePc01 && (
						<div class="col-span-2 bg-gray01 aspect-video overflow-hidden">
							<Image src={project.imagePc01} alt='pc design' width={1600} height={900} class="w-full h-full object-cover"></Image>
						</div>
					)}
					{ project.imagePc02 && (
						<div class="col-span-2 bg-gray01 aspect-video overflow-hidden">
							<Image src={project.imagePc02} alt='pc design' width={1600} height={900} class="w-full h-full object-cover"></Image>
						</div>
					)}
					<div class="col-span-2 grid grid-cols-3 gap-x-[8px] lg:gap-x-[1em]">
						{ project.imageSp01 && (
							<div class="bg-gray01 aspect-[9/16] overflow-hidden">
								<Image src={project.imageSp01} alt='sp design' width={600} height={1067} class="w-full h-full object-cover"></Image>
							</div>
						)}
						{ project.imageSp02 && (
							<div class="bg-gray01 aspect-[9/16] overflow-hidden">
								<Image src={project.imageSp02} alt='sp design' width={600} height={1067} class="w-full h-full object-cover"></Image>
							</div>
						)}
						{ project.imageSp03 && (
							<div class="bg-gray01 aspect-[9/16] overflow-hidden">
								<Image src={project.imageSp03} alt='sp design' width={600} height={1067} class="w-full h-full object-cover"></Image>
							</div>
						)}
					</div>
				</div>

				<div class="prev-next flex justify-between items-center h-more-200 lg:mt-more-100">
					<a href="" class="">{'< prev'}</a>
					<a href="" class="">{'next >'}</a>
				</div>
			</div>
		</article>
	))}
	</div>	
</main>

<style lang="scss" is:global>
	.modal-overlay {
		position: fixed;
		top: 0;
		left: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		padding: 0 0 0 var(--s-16-60);
		z-index: 1000;
	}

	.modal-content {
		position: relative;
		width: 100%;
		height: 100%;
		// clip-path: inset(0 0 0 0%);
	}

	.modal-close {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: none;
		border: none;
		font-size: 2rem;
		cursor: pointer;
		color: #666;
	}

	#modal-container {
		// display: none;

	}
</style>